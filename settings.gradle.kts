/*
 * This file was generated by the Gradle 'init' task.
 *
 * The settings file is used to specify which projects to include in your build.
 * For more detailed information on multi-project builds, please refer to https://docs.gradle.org/8.11.1/userguide/multi_project_builds.html in the Gradle documentation.
 */

pluginManagement {
    repositories {
        gradlePluginPortal()
        mavenCentral()
        maven("https://repo.papermc.io/repository/maven-public/")
        maven("https://maven.fabricmc.net/")
        maven("https://maven.neoforged.net/releases/")
    }
}

plugins {
    id("org.gradle.toolchains.foojay-resolver-convention") version "0.9.0"
}

rootProject.name = "RapunzelLib"

include(
    "api",
    "common",
    "commands",
    "commands-paper",
    "commands-fabric",
    "commands-neoforge",
    "events",
    "events-paper",
    "events-fabric",
    "events-neoforge",
    "network",
    "database-spool",
    "platform-paper",
    "platform-fabric",
    "platform-velocity",
    "platform-neoforge",
    "tool-server-runner",
    "gradle-plugin",
)

// Workaround for NeoForge ModDev (net.neoforged.moddev) IntelliJ sync:
// During IntelliJ import (`idea.sync.active=true`), ModDev applies idea-ext on the root project.
// When multiple NeoForge subprojects do that in the same import, it can clash on the root "settings" extension.
// Limit the IntelliJ-specific integration to the platform module during sync.
val originalIdeaSyncActive: String? = System.getProperty("idea.sync.active")
val disableIdeaSyncForProjects = setOf(":commands-neoforge", ":events-neoforge")
val ideaSyncKey = "idea.sync.active"

fun restoreIdeaSyncProperty() {
    if (originalIdeaSyncActive == null) {
        System.clearProperty(ideaSyncKey)
    } else {
        System.setProperty(ideaSyncKey, originalIdeaSyncActive)
    }
}

gradle.beforeProject {
    val project = this
    if (originalIdeaSyncActive == "true" && project.path in disableIdeaSyncForProjects) {
        System.setProperty(ideaSyncKey, "false")
    }
}

gradle.afterProject {
    val project = this
    if (originalIdeaSyncActive == "true" && project.path in disableIdeaSyncForProjects) {
        restoreIdeaSyncProperty()
    }
}
